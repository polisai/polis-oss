# Mutual TLS (mTLS) Configuration
# This example shows TLS termination with client certificate authentication

server:
  admin_address: ":19090"
  data_address: ":8443"

  tls:
    enabled: true
    cert_file: "./certs/server.crt"
    key_file: "./certs/server.key"
    min_version: "1.2"

    # Client certificate authentication
    client_auth:
      required: true
      ca_file: "./certs/ca.crt"
      verify_mode: "strict"

telemetry:
  otlp_endpoint: "http://localhost:4317"
  insecure: true

control_plane:
  address: "localhost:9090"
  mtls_enabled: false

# Pipeline with enhanced security for authenticated clients
pipelines:
  - id: "mtls-pipeline"
    version: 1
    description: "mTLS termination with security scanning"
    agentId: "*"
    protocol: "http"
    nodes:
      # DLP scanning on authenticated traffic
      - id: "dlp-scan"
        type: "policy.dlp"
        config:
          rules: ["pii-detection", "financial-data"]

      # WAF protection
      - id: "waf-check"
        type: "policy.waf"
        config:
          ruleset: "owasp-core"

      # Forward to secure backend
      - id: "egress"
        type: "egress.http"
        config:
          upstream_url: "https://secure-backend.internal:8443"
          upstream_tls:
            enabled: true
            ca_file: "./certs/backend-ca.crt"
            cert_file: "./certs/client.crt"
            key_file: "./certs/client.key"
            min_version: "1.2"

logging:
  level: "info"
