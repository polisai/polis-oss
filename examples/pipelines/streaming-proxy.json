{
  "id": "streaming-proxy",
  "version": 1,
  "agentId": "streaming-agent",
  "protocol": "http",
  "defaults": {
    "timeoutMs": 300000
  },
  "nodes": [
    {
      "id": "auth",
      "type": "auth.jwt.validate",
      "config": {
        "issuer": "https://auth.example.com",
        "audience": "streaming-api"
      },
      "posture": "fail-closed",
      "on": {
        "success": "check_streaming",
        "failure": "deny"
      }
    },
    {
      "id": "check_streaming",
      "type": "policy.opa",
      "config": {
        "bundleRef": "streaming-policies",
        "bundleVersion": 1,
        "entrypoint": "policy/validate_streaming"
      },
      "posture": "fail-closed",
      "on": {
        "success": "egress_streaming",
        "failure": "deny"
      }
    },
    {
      "id": "egress_streaming",
      "type": "egress.http",
      "config": {
        "upstream_url": "https://stream.example.com/sse",
        "timeout_ms": 300000,
        "streaming": true,
        "idle_timeout_ms": 60000
      },
      "governance": {
        "timeoutMs": 300000,
        "circuitBreaker": {
          "window": "60s",
          "failureRateThreshold": 60
        }
      },
      "on": {
        "success": "allow",
        "failure": "deny",
        "timeout": "deny"
      }
    },
    {
      "id": "allow",
      "type": "terminal.allow"
    },
    {
      "id": "deny",
      "type": "terminal.deny"
    }
  ],
  "triggers": [
    {
      "type": "http.request",
      "match": {
        "headers": {
          "Accept": "text/event-stream"
        }
      }
    },
    {
      "type": "http.request",
      "match": {
        "headers": {
          "Upgrade": "websocket"
        }
      }
    }
  ]
}
