{
  "id": "dlp-enabled",
  "version": 1,
  "agentId": "secure-api-agent",
  "protocol": "http",
  "defaults": {
    "timeoutMs": 8000
  },
  "nodes": [
    {
      "id": "auth",
      "type": "auth.jwt.validate",
      "config": {
        "issuer": "https://auth.example.com",
        "audience": "api"
      },
      "posture": "fail-closed",
      "on": {
        "success": "waf_ingress",
        "failure": "deny"
      }
    },
    {
      "id": "waf_ingress",
      "type": "policy.waf",
      "config": {
        "rules": ["sql_injection", "xss", "path_traversal"],
        "action": "block"
      },
      "posture": "fail-closed",
      "governance": {
        "timeoutMs": 500
      },
      "on": {
        "success": "dlp_ingress",
        "failure": "waf_blocked"
      }
    },
    {
      "id": "dlp_ingress",
      "type": "policy.dlp",
      "config": {
        "rules": ["credit_card", "ssn", "api_keys"],
        "action": "redact",
        "scope": "request"
      },
      "posture": "fail-open",
      "governance": {
        "timeoutMs": 1000
      },
      "on": {
        "success": "egress",
        "failure": "egress"
      }
    },
    {
      "id": "egress",
      "type": "egress.http",
      "config": {
        "upstream_url": "https://internal-api.example.com",
        "timeout_ms": 5000
      },
      "governance": {
        "timeoutMs": 5000,
        "circuitBreaker": {
          "window": "15s",
          "failureRateThreshold": 50
        }
      },
      "on": {
        "success": "dlp_egress",
        "failure": "deny",
        "timeout": "deny"
      }
    },
    {
      "id": "dlp_egress",
      "type": "policy.dlp",
      "config": {
        "rules": ["pii", "confidential_data", "internal_secrets"],
        "action": "block",
        "scope": "response"
      },
      "posture": "fail-closed",
      "governance": {
        "timeoutMs": 1000
      },
      "on": {
        "success": "allow",
        "failure": "dlp_blocked"
      }
    },
    {
      "id": "allow",
      "type": "terminal.allow"
    },
    {
      "id": "deny",
      "type": "terminal.deny"
    },
    {
      "id": "waf_blocked",
      "type": "terminal.deny",
      "config": {
        "status_code": 403,
        "message": "Request blocked by Web Application Firewall"
      }
    },
    {
      "id": "dlp_blocked",
      "type": "terminal.deny",
      "config": {
        "status_code": 451,
        "message": "Response blocked: Data Loss Prevention policy violation"
      }
    }
  ]
}
