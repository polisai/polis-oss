id: cost-control-pipeline
agentId: "*"
protocol: http
nodes:
  - id: start
    type: auth
    on:
      success: cost_check
      failure: deny

  - id: cost_check
    type: policy
    config:
      entrypoint: "policy/cost/decision"
      posture: "fail-closed"
    on:
      success: egress
      failure: deny

  - id: egress
    type: egress
    config:
      upstream_url: https://api.openai.com
    on:
      success: ""

  - id: deny
    type: terminal.deny
